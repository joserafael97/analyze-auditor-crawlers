---
title: "fornecedores_portais_transparencia"
output:
    html_document:
    df_print: paged
theme: sandstone
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse) # 
library(dplyr) # 
library(here)
library(ggplot2)
library(knitr)
library(kableExtra)
```


Este relatório apresenta uma breve análise sobre empresas fornecedoras de portais de transparência no estado da Paraíba. Esta análise mantém o foco no número de empresas existentes e todas as possíveis combinações.

Os dados utililizados foram coletados por uma análise manual de todos os 223 municípios do estado. 


## Lendo os dados

```{r read}
empresas_portais <- readr::read_csv(here::here("data/empresas_portais.csv"))
fornecedores <- readr::read_csv(here::here("data/empresas.csv"))
amostra <- readr::read_csv(here::here("data/amostra.csv"))
```

Abaixo é apresentado o nome de cada empresa identificada, somando 24 empresas. 

```{r}
kable(fornecedores) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

Entre os portais da transparência do estado é possível encontrar diferentes combinações entre fornecedores. Desta forma, foi analisado as possíveis combinaçoes e a frequência de ocorrência de cada uma delas. Tais combinações são mostradas abaixo. 

```{r}
empresas_portais[is.na(empresas_portais)] <- ""


empresas_portais %>%
    group_by(fornecedor) %>%
    summarise(num_municipios_atendidos = n()) %>%
    arrange(desc(num_municipios_atendidos)) %>% 
    kable() %>%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
    
```
Obs: Durante a coleta alguns layouts não identificados foram agrupados por semelhanla dando origem ao grupo Portal Próprio. 

Existem 49 combinações diferentes entre os fornecedores. A Publicsoft sozinha (Sem contar combinações) é a empresa que mais atende municípios (49).

No entanto, existem na Tabela acima é observado uma grande quantidade de combinação com uma única ocorrência. Assim, vamos verificar somente as combinações com ao menos duas ocorrência.


```{r}
empresas_portais %>%
    group_by(fornecedor) %>%
    summarise(num_municipios_atendidos = n()) %>%
    filter(num_municipios_atendidos > 1) %>%
    ggplot() + 
    geom_point(aes(x=num_municipios_atendidos, y=reorder(fornecedor, +num_municipios_atendidos)), position = "jitter", color='darkblue')  
```

De acorco com a Figura acima é possível observar uma redução do número de combinações, sendo anteriormente 49 e passando para 18.

Neste contexto, para a análise da eficácia e eficiência do crawler durante as avaliações fiscais é fundamental estabelecer a população/amostra que servirá de base representativa do contexto avaliado. Nesta perspectiva, foi utilizado um recorte de 30 portais de transparência de diferentes municípios da Paraíba, representando 13.4% dos 223 portais existentes no estado.

Como forma de garantir a construção de uma amostra de portais representativa para avaliação da ferramenta os critérios fornecedor do portal, número de portais, as combinações entre fornecedores e a frequência de aparição da combinação foram considerados. Neste sentido, para cada combinação contendo mais de 2 portais foram selecionados de forma aleatória o número de portais que representassem um número superior 10% da combinação na população. A proporção de conmbinações selecionadas para amostra é apresentado na Figura abaixo.


```{r}
amostra %>%
    ggplot() + 
    geom_point(aes(y=reorder(`Combinação`, +`nº portais`), x=`nº portais`), position = "jitter", color='darkblue')  
```
Algumas combinações como Alfa Consultoria / e-TICons, Alfa Consultoria / Info Public apesar de atenderem mais de um portal foram desconsidaradas por possuirem layouts e navegação similares com outras combinações presentes na amostra como Alfa Consultoria / Elmar Tecnologia.



