---
title: "REPLACE ME"
output:
    html_document:
    df_print: paged
theme: sandstone
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse) # 
library(jsonlite) # Ler dados json
library(dplyr) # 
library(here)
library(ggplot2)
source(here::here("code/lib.R"))
theme_set(theme_bw())
```

## Lendo os dados

```{r read}
resultados_avaliacoes = read_avaliacoes('João Pessoa')
gararito = read_gabaritos('João Pessoa') 
data<-full_join(gararito, resultados_avaliacoes, by=c("municipio", "item", "criterio"))

```


```{r}
data[is.na(data)] <- ""

precisao <- data %>% 
    group_by(municipio, criterio, item) %>% 
    mutate(
           
           #verifica se a avaliação foi acertiva
           tp = valid == TRUE 
           & valid == encontrado 
           #valida se no gabarito e na avaliação o item foi encontrado na mesma url 
           & (grepl(local_encontrado, pathSought) |
                  grepl(local_encontrado_2, pathSought)),
           
           fn =  valid == FALSE 
           & encontrado == TRUE,
           
           fp = valid == TRUE 
           & encontrado == FALSE
          )
```

Quantificando métricas
```{r}
tp <-  sum(precisao$tp)
fn <- sum(precisao$fn)
fp <- sum(precisao$fp)
```


Recall

```{r}
recall <- tp/(tp+fn)
recall
```

Precision

```{r}
precision <- tp/(tp+fp)
precision
```
F1-score
```{r}
(2*(recall*precision))/(recall+precision)
```



