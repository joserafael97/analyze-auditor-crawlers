---
title: "REPLACE ME"
output:
    html_document:
    df_print: paged
theme: sandstone
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse) # 
library(jsonlite) # Ler dados json
library(dplyr) # 
library(here)
library(ggplot2)
source(here::here("code/lib.R"))
theme_set(theme_bw())
```

## Lendo os dados

```{r read}
resultados_avaliacoes = read_avaliacoes()
gararito = read_gabaritos() 
data<-full_join(gararito, resultados_avaliacoes, by=c("municipio", "item", "criterio"))

data %>% 
    group_by(item, criterio) %>% 
    summarise(num = count(municipio == 'Esperança'))
```


```{r}
data[is.na(data)] <- ""

precisao <- data %>% 
    group_by(municipio, criterio, item) %>% 
    mutate(
           
           tp = encontrado_turmalina == TRUE 
           & encontrado_turmalina == encontrado 
           & (grepl(local_encontrado, local_encontrado_turmalina) |
                  grepl(local_encontrado_2, local_encontrado_turmalina)),
           
           fn =  encontrado_turmalina == FALSE 
           & encontrado == TRUE,
           
           fp = encontrado_turmalina == TRUE 
           & encontrado == FALSE
          )
```

Quantificando métricas
```{r}
tp <-  sum(precisao$tp)
fn <- sum(precisao$fn)
fp <- sum(precisao$fp)
```


Recall

```{r}
recall <- tp/(tp+fn)
recall
```

Precision

```{r}
precision <- tp/(tp+fp)
precision
```
F1-score
```{r}
(2*(recall*precision))/(recall+precision)
```



